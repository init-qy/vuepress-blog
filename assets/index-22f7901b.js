import{f as G,o as m,g as I,w as o,d as t,u as e,a as s,t as H,N as J,_ as K,h as c,i as ie,j as q,c as z,F,k as le,b as k,l as A,n as W,m as we,p as _e,q as be,s as Ce,v as ye,x as xe,r as Re,y as ke}from"./app-9efc7c01.js";const Ie=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),Ne=()=>(async f=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(f)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));const Pe=s("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32"},[s("path",{d:"M17 22v-8h-4v2h2v6h-3v2h8v-2h-3z",fill:"currentColor"}),s("path",{d:"M16 8a1.5 1.5 0 1 0 1.5 1.5A1.5 1.5 0 0 0 16 8z",fill:"currentColor"}),s("path",{d:"M16 30a14 14 0 1 1 14-14a14 14 0 0 1-14 14zm0-26a12 12 0 1 0 12 12A12 12 0 0 0 16 4z",fill:"currentColor"})],-1),Se=G({__name:"infoIcon",props:{info:String},setup(f){const h=f,{NIcon:b,NPopover:N}=J;return(x,u)=>(m(),I(e(N),{trigger:"hover",duration:500,class:"max-w-200px"},{trigger:o(()=>[t(e(b),{size:"20",class:"ml-2.5 hover:cursor-pointer hover:color-$theme-color"},{default:o(()=>[Pe]),_:1})]),default:o(()=>[s("span",null,H(h.info),1)]),_:1}))}}),se=K(Se,[["__file","infoIcon.vue"]]),Me={class:"mb-2.5"},De=s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",fill:"currentColor",class:"el-icon-upload",viewBox:"0 0 16 16"},[s("path",{"fill-rule":"evenodd",d:"M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"}),s("path",{d:"M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"})],-1),Ae={class:"display-none"},$e=G({__name:"sideControl",emits:["save","process"],setup(f,{expose:h,emit:b}){const{NButton:N,NForm:x,NFormItem:u,NIcon:$,NImage:U,NP:B,NRadioButton:C,NRadioGroup:P,NSpace:L,NUpload:Q,NUploadDragger:S}=J,T=c(),M=c(),y=ie("realcuganParams",{scaleRadio:2,denoiseRadio:0,previewRadio:0}),g=c(""),E=[{value:2,label:"2X"},{value:3,label:"3X"}],Y=q(()=>[{value:-1,label:"保守"},{value:0,label:"无降噪"},{value:3,label:"降噪3X",disabled:!1}]),Z=[{value:0,label:"叠图"},{value:1,label:"并排"},{value:2,label:"并列"}],O=function({file:p}){const i=M.value;if(!i)return;const a=i.getContext("2d"),d=new Image,R=new FileReader;R.onload=function({target:w}){typeof w.result=="string"&&(g.value=w.result,d.src=w.result)},R.onerror=function(w){console.error(w)},R.readAsDataURL(p.file),d.onload=function(){i.width=d.width,i.height=d.height,a.drawImage(d,0,0);const w=a.getImageData(0,0,i.width,i.height);b("process",w,i.width,i.height,p.name)},d.onerror=function(w){console.error(w)}},D=function(){const p=M.value;if(!p)return;const i=p.getContext("2d"),a="testImage.jpg",d=new Image;d.onload=function(){p.width=d.width,p.height=d.height,i.drawImage(d,0,0);const R=i.getImageData(0,0,p.width,p.height);b("process",R,p.width,p.height,a)},g.value=a,d.src=a};return h({resetImage:function(){g.value=""},canvasUploadRef:M}),(p,i)=>(m(),z(F,null,[t(e(L),{vertical:"",class:"w-400px flex-shrink-0"},{default:o(()=>[t(e(x),{ref_key:"formRef",ref:T,model:e(y),"label-placement":"left","label-align":"left","label-width":"120","require-mark-placement":"right-hanging"},{default:o(()=>[t(e(u),{label:"超分倍率 :",path:"scaleRadio"},{default:o(()=>[t(e(P),{value:e(y).scaleRadio,"onUpdate:value":i[0]||(i[0]=a=>e(y).scaleRadio=a),name:"scaleRadio"},{default:o(()=>[(m(),z(F,null,le(E,a=>t(e(C),{key:a.value,value:a.value,label:a.label},null,8,["value","label"])),64))]),_:1},8,["value"]),t(se,{info:"会决定输出图片的尺寸。目前3X处理会耗时比较久，推荐2X"})]),_:1}),t(e(u),{label:"降噪配置 :",path:"denoiseRadio"},{default:o(()=>[t(e(P),{value:e(y).denoiseRadio,"onUpdate:value":i[1]||(i[1]=a=>e(y).denoiseRadio=a),name:"denoiseRadio"},{default:o(()=>[(m(!0),z(F,null,le(Y.value,a=>(m(),I(e(C),{key:a.value,value:a.value,label:a.label,disabled:a.disabled},null,8,["value","label","disabled"]))),128))]),_:1},8,["value"]),t(se,{info:"降噪版: 如果原片噪声多，压得烂，推荐使用； 无降噪版：适合原图噪声不多，想提高分辨率/清晰度/做通用性的增强、修复处理； 保守版: 如果你担心丢失纹理，担心画风被改变，担心颜色被增强，总之就是各种担心AI会留下浓重的处理痕迹，推荐使用该版本"})]),_:1}),t(e(u),{label:"预览模式 :",path:"previewRadio"},{default:o(()=>[t(e(P),{value:e(y).previewRadio,"onUpdate:value":i[2]||(i[2]=a=>e(y).previewRadio=a),name:"previewRadio"},{default:o(()=>[(m(),z(F,null,le(Z,a=>t(e(C),{key:a.value,value:a.value,label:a.label},null,8,["value","label"])),64))]),_:1},8,["value"])]),_:1}),t(e(u),null,{default:o(()=>[g.value?A("v-if",!0):(m(),I(e(Q),{key:0,accept:"image/png,image/jpeg,image/webp,image/bmp","default-upload":!0,"show-file-list":!1,"list-type":"image",onChange:O},{default:o(()=>[t(e(S),null,{default:o(()=>[s("div",Me,[t(e($),{size:"48",depth:3},{default:o(()=>[De]),_:1})]),t(e(B),{class:"text-sm"},{default:o(()=>[k(" 点击或者拖动图片到该区域来上传 ")]),_:1}),t(e(B),{class:"text-xs"},{default:o(()=>[k(" 只能选取jpg/png/webp/bmp文件 ")]),_:1})]),_:1})]),_:1})),g.value?(m(),I(e(U),{key:1,src:g.value,class:"max-w-300px hover:cursor-pointer"},null,8,["src"])):A("v-if",!0)]),_:1}),g.value?A("v-if",!0):(m(),I(e(N),{key:0,strong:"",secondary:"",onClick:D},{default:o(()=>[k(" 使用示例图片 ")]),_:1}))]),_:1},8,["model"])]),_:1}),s("div",Ae,[s("canvas",{id:"canvas-upload",ref_key:"canvasUploadRef",ref:M},null,512)])],64))}});const Ue=K($e,[["__file","sideControl.vue"]]);const re=f=>(_e("data-v-03822632"),f=f(),be(),f),Be=["src"],Oe={class:"after-image"},ze=["src"],Le=["onMousedown"],Fe={class:"arrow"},Te=re(()=>s("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[s("g",{fill:"none"},[s("path",{d:"M15 17.898c0 1.074-1.265 1.648-2.073.941l-6.31-5.522a1.75 1.75 0 0 1 0-2.634l6.31-5.522c.808-.707 2.073-.133 2.073.941v11.796z",fill:"currentColor"})])],-1)),Ee=re(()=>s("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},[s("g",{fill:"none"},[s("path",{d:"M9 17.898c0 1.074 1.265 1.648 2.073.941l6.31-5.522a1.75 1.75 0 0 0 0-2.634l-6.31-5.522C10.265 4.454 9 5.028 9 6.102v11.796z",fill:"currentColor"})])],-1)),Xe=G({__name:"imgCompare",props:{width:Number,height:Number,backImg:String,frontImg:String},setup(f){const h=f,{NIcon:b}=J,N=c(),x=q(()=>({width:`${h.width}px`,height:`${h.height}px`})),u=c(h.width/2),$=c(!0),U=function(B){$.value=!0;const C=e(N).offsetLeft;u.value=C;const P=B.clientX-C;document.onmousemove=function(L){$.value&&(u.value=L.clientX-P,u.value>=h.width?u.value=h.width:u.value<=0&&(u.value=0))},document.onmouseup=function(){return $.value=!1,document.onmousemove=document.onmouseup=null,!1}};return(B,C)=>(m(),z("div",{class:"PictureComparison",style:W(x.value)},[s("div",{class:"before-image",style:W(`width:${u.value}px`)},[s("img",{src:f.frontImg,alt:"",style:W(x.value),class:"h-auto !max-w-screen"},null,12,Be)],4),s("div",Oe,[s("img",{src:f.backImg,alt:"",style:W(x.value),class:"h-auto !max-w-screen"},null,12,ze)]),s("div",{ref_key:"sliderRef",ref:N,class:"divider-bar",style:W(`left:${u.value}px`),onMousedown:we(U,["prevent"])},[s("div",Fe,[t(e(b),{size:"19"},{default:o(()=>[Te]),_:1}),t(e(b),{size:"19"},{default:o(()=>[Ee]),_:1})])],44,Le)],4))}});const je=K(Xe,[["__scopeId","data-v-03822632"],["__file","imgCompare.vue"]]),Ve={class:"flex mt-10"},We={class:"display-none"},He=G({__name:"index",setup(f){const{NAlert:h,NButton:b,NConfigProvider:N,NImage:x,NP:u,NProgress:$,NSpace:U,createDiscreteApi:B,darkTheme:C,lightTheme:P}=J,{isDarkmode:L}=Ce(),Q=q(()=>({theme:L.value?C:P}));let S,T;const M=c(),y=c(),g=c("#41b349");let E;const Y=q(()=>({common:{primaryColor:e(g)}})),Z=ke();let O=null,D=null;const X=c(),p=c(!1),i=ie("realcuganParams",{scaleRadio:2,denoiseRadio:0,previewRadio:0}),a=c(3),d=c(""),R=c(0),w=c(0),ne=c({fileName:"",scaleRadio:2,denoiseRadio:0,previewRadio:0}),ee=c(""),ae=c(""),j=c({width:0,height:0}),ce=function(v,l,n,r=""){const V=M.value.canvasUploadRef;ee.value=V.toDataURL();const _=X.value;if(!_)return;const fe=_.getContext("2d"),{scaleRadio:oe,denoiseRadio:he}=i.value;a.value=2,d.value="启动中，预计10秒内完成耗时估算...",R.value=0,ne.value={fileName:r,...e(i)},_.width=l*oe,_.height=n*oe,O=window._malloc(v.data.length),window.HEAPU8.set(v.data,O);const ge=fe.getImageData(0,0,_.width,_.height);D=window._malloc(ge.data.length),window._process_image(0,O,D,l,n,oe,he)!==0&&(S.warning("请稍后再试"),a.value=1)},ue=function(v){const l=X.value;if(!l)return;const n=l.getContext("2d"),r=n.getImageData(0,0,l.width,l.height);j.value.width=Math.min(y.value.clientWidth,l.width),j.value.height=j.value.width*l.height/l.width;const V=window.HEAPU8.subarray(D,D+r.data.length);r.data.set(V),n.putImageData(r,0,0),ae.value=l.toDataURL(),window._free(O),window._free(D),O=null,D=null,M.value.resetImage(),a.value=0;const _=(v/1e3).toFixed(2);d.value=`处理完成！耗时: ${_}秒`,S.success(`处理完成！耗时: ${_}秒`)},de=function(v,l,n,r){a.value=2,d.value="本地CPU努力处理中......",R.value=Math.floor(n*1e4)/100,w.value=Math.round(r/10)/100},ve=function(v){try{const l=JSON.parse(v);switch(l.eventType){case"PROC_END":ue(l.cost);break;case"PROC_PROGRESS":de(l.total_cost,l.tile_cost,l.progress_rate,l.remaining_time)}}catch(l){a.value=1,console.error("wasmCallback parse error:",l)}},me=async function(){const[v,l]=await Promise.all([Ie(),Ne()]);if(!v){S.error("浏览器不支持simd (不支持iOS，Android请单独用Chrome/Firefox等浏览器打开，桌面端请使用最新版本的Chrome或Firefox)",{keepAliveOnHover:!0});return}if(!l){S.error("浏览器不支持pthreads (不支持iOS，Android请单独用Chrome/Firefox等浏览器打开，桌面端请使用最新版本的Chrome或Firefox)",{keepAliveOnHover:!0});return}fetch("realcugan-ncnn-webassembly-simd-threads.wasm").then(n=>{n.arrayBuffer()}).then(n=>{window.Module.wasmBinary=n;const r=document.createElement("script");r.src="realcugan-ncnn-webassembly-simd-threads.js",r.onload=()=>{},document.body.appendChild(r),window.Module.onRuntimeInitialized=()=>{p.value=!0}})},pe=function(){const v=X.value;if(!v)return;const l=v.toDataURL("image/png").replace("image/png","image/octet-stream"),n=document.createElement("a");n.href=l;let{fileName:r,scaleRadio:V,denoiseRadio:_}=e(ne);switch(r?r=r.replace(/\.[^/.]+$/,""):r="realcugan-output",r+=`-up${V}x`,_){case-1:r+="-conservative.png";break;case 0:r+="-denoise.png";break;case 3:r+="-denoise3x.png";break}n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n),S.success("保存成功")},te=function(){window.location.reload()};return ye(()=>{window.Module={print:n=>{n.length>11&&n.substring(0,10)==="$CALLBACK$"&&ve(n.substring(11))},printErr:n=>{console.error(n),`${n}`.includes("memory access out of bounds")?T.error({title:"标签页内存受限",content:"本页面多次处理图片后，触发了浏览器内存限制，请点击刷新按钮重试",closable:!1,positiveText:"刷新",onPositiveClick:te}):T.error({title:"处理错误",content:`错误信息: ${n}`,closable:!1,positiveText:"刷新重试",onPositiveClick:te})}};const v=B(["message","dialog"],{configProviderProps:Q});S=v.message,T=v.dialog;const l=function(){window.location.pathname.includes(Z.value.path)?me():setTimeout(()=>{l()},100)};l(),E=setInterval(()=>{g.value=window.getComputedStyle(document.body).getPropertyValue("--theme-color")},1e3)}),xe(()=>{E&&clearInterval(E)}),(v,l)=>{const n=Re("ClientOnly");return m(),I(n,null,{default:o(()=>[t(e(N),{theme:e(L)?e(C):e(P),"theme-overrides":Y.value},{default:o(()=>[t(e(h),{title:"本项目基于Web Assembly技术，在浏览器端使用CPU完成图像处理，不会上传任何图片到云端。",type:"info",closable:""},{default:o(()=>[k(" 注意：本页面处理图片时占用内存约900M，且CPU占用较高。如果使用有问题，请在PC端使用最新版的Chrome或Firefox打开本页面。如输出有问题或长时间无响应，请刷新重试。 ")]),_:1}),s("div",Ve,[t(Ue,{ref_key:"sideControlRef",ref:M,onProcess:ce},null,512),A(" preview "),s("div",{ref_key:"previewBoxRef",ref:y,class:"flex-1 ml-16"},[A("      进度条 "),p.value?A("v-if",!0):(m(),I(e(u),{key:0},{default:o(()=>[k("资源努力加载中(约12MB)......")]),_:1})),a.value===2?(m(),z(F,{key:1},[t(e(U),{justify:"space-between",class:"mb-2.5"},{default:o(()=>[t(e(u),null,{default:o(()=>[k(H(d.value)+" 剩余时长: "+H(w.value.toFixed(2))+"秒",1)]),_:1}),t(e(b),{round:"",size:"small",strong:"",secondary:"",onClick:te},{default:o(()=>[k(" 取消处理 ")]),_:1})]),_:1}),t(e($),{type:"line",color:g.value,percentage:R.value,"indicator-placement":"inside",processing:""},null,8,["color","percentage"])],64)):A("v-if",!0),a.value===0?(m(),z(F,{key:2},[t(e(U),{justify:"space-between",class:"mb-2.5"},{default:o(()=>[t(e(u),null,{default:o(()=>[k(H(d.value),1)]),_:1}),t(e(b),{color:g.value,round:"",size:"small",onClick:pe},{default:o(()=>[k(" 保存图片 ")]),_:1},8,["color"])]),_:1}),e(i).previewRadio===0?(m(),I(je,{key:0,width:j.value.width,height:j.value.height,"front-img":ae.value,"back-img":ee.value},null,8,["width","height","front-img","back-img"])):(m(),I(e(U),{key:1,wrap:e(i).previewRadio===2},{default:o(()=>[t(e(x),{src:ee.value,alt:"uploadImg"},null,8,["src"]),t(e(x),{src:ae.value,alt:"outputImg"},null,8,["src"])]),_:1},8,["wrap"]))],64)):A("v-if",!0)],512)])]),_:1},8,["theme","theme-overrides"]),s("div",We,[s("canvas",{id:"canvas-output",ref_key:"canvasOutputRef",ref:X},null,512)])]),_:1})}}});const Je=K(He,[["__file","index.vue"]]);export{Je as R};
