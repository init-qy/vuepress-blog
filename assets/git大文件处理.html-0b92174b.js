import{_ as t,r as i,o,c as r,a as e,b as a,d as n,e as l}from"./app-76d126c1.js";const c={},p=l(`<h2 id="background" tabindex="-1"><a class="header-anchor" href="#background" aria-hidden="true">#</a> Background</h2><p>Recently, I have been working on a mobile app project using <code>flutter+unity</code>. Since it is my first time developing with <code>unity</code>, I am not very familiar with the file structure of <code>unity</code>. As a result, many 3D model files from the test assets have been included in the <code>git</code> repository, causing the repository to become bloated.</p><p>In fact, managing these assets with <code>svn</code> would be better, considering the large number of images, audio, and binary files involved. However, since the project is currently small, managing them with <code>git</code> is still acceptable.</p><h2 id="steps" tabindex="-1"><a class="header-anchor" href="#steps" aria-hidden="true">#</a> Steps</h2><ol><li><p>Check the size of the git repository</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> count-objects <span class="token parameter variable">-vH</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Identify the large files</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> rev-list <span class="token parameter variable">--objects</span> <span class="token parameter variable">--all</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> verify-pack <span class="token parameter variable">-v</span> .git/objects/pack/*.idx <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-k</span> <span class="token number">3</span> <span class="token parameter variable">-n</span> <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-10</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print$1}&#39;</span><span class="token variable">)</span></span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Remove the files from the git repository history</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> filter-branch <span class="token parameter variable">--force</span> --index-filter <span class="token string">&#39;git rm -rf --cached --ignore-unmatch &lt;bigfile&gt;&#39;</span> --prune-empty --tag-name-filter <span class="token function">cat</span> -- <span class="token parameter variable">--all</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Reclaim local space</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-rf</span> .git/refs/original/
<span class="token function">git</span> reflog expire <span class="token parameter variable">--expire</span><span class="token operator">=</span>now <span class="token parameter variable">--all</span>
<span class="token function">git</span> gc <span class="token parameter variable">--prune</span><span class="token operator">=</span>now
<span class="token function">git</span> gc <span class="token parameter variable">--aggressive</span> <span class="token parameter variable">--prune</span><span class="token operator">=</span>now
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Push to the remote repository</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> push origin <span class="token parameter variable">--force</span> <span class="token parameter variable">--all</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h2 id="other" tabindex="-1"><a class="header-anchor" href="#other" aria-hidden="true">#</a> Other</h2><p>After completing the above steps and pushing to the remote repository, you may sometimes find that the remote git repository not only did not decrease in size, but even increased. This is because the remote <code>git</code> repository has not been garbage collected.</p>`,7),d=e("code",null,"GitLab",-1),u={href:"https://docs.gitlab.com/ee/administration/housekeeping.html#running-housekeeping-tasks",target:"_blank",rel:"noopener noreferrer"},h=e("code",null,"Housekeeping",-1),m=e("code",null,"GitLab",-1),g={href:"https://juejin.cn/post/7024922528514572302",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new",target:"_blank",rel:"noopener noreferrer"},v=e("strong",null,"feedback",-1);function k(f,_){const s=i("ExternalLinkIcon");return o(),r("div",null,[p,e("p",null,[a("I am using the internal "),d,a(" of the company as an example. You can use the "),e("a",u,[h,n(s)]),a(" feature of "),m,a(" to address this issue.")]),e("p",null,[a("For more details, please refer to "),e("a",g,[a("this article"),n(s)]),a(".")]),e("blockquote",null,[e("p",null,[a("This post is translated using ChatGPT, please "),e("a",b,[v,n(s)]),a(" if any omissions.")])])])}const x=t(c,[["render",k],["__file","git大文件处理.html.vue"]]);export{x as default};
